<!DOCTYPE html>
<html
  lang="en"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{default}"
>
  <head>
    <script
      type="text/javascript"
      src="/webjars/jquery/3.6.0/jquery.min.js"
    ></script>
  </head>
  <body>
    <main style="background-color: white" layout:fragment="content">
      <div th:text="${errors}" class="margin-bottom alert-danger"></div>
      <form
        action="#"
        th:action="@{/product/{id}(id=${id})}"
        th:object="${productDto}"
        enctype="multipart/form-data"
        method="post"
      >
        <div class="mb-3">
          <label for="name" class="form-label">Название</label>
          <input
            type="text"
            class="form-control"
            id="name"
            th:field="${productDto.name}"
            required="true"
          />
        </div>
        <div class="mb-3">
          <label for="price" class="form-label">Цена</label>
          <input
            type="text"
            class="form-control"
            id="price"
            th:value="${productDto.price}"
            disabled
            required="true"
          />
        </div>
        <div class="mb-3">
          <label for="image" class="form-label">Изображение</label>
          <input type="file" class="form-control" id="image" th:name="file" />
        </div>
        <div class="mb-3">
          <button type="submit" class="btn btn-primary button-fixed">
            <span th:if="${id == null}">Добавить</span>
            <span th:if="${id != null}">Обновить</span>
          </button>
          <a class="btn btn-secondary button-fixed" th:href="@{/product}">
            Назад
          </a>
        </div>
      </form>
      <form
        th:if="${id != null}"
        action="#"
        th:action="@{/product/addproduct/{id}(id=${id})}"
        th:object="${componentDto}"
        method="post"
      >
        <div class="mb-3">
          <label for="lang" class="form-label">Компонент</label>
          <select id="lang" class="form-select" th:field="${componentDto.id}">
            <option
              th:each="value: ${components}"
              th:value="${value.getId()}"
              th:selected="true"
              th:text="${value.getComponentName()}"
            ></option>
          </select>
        </div>
        <div class="mb-3">
          <label for="count" class="form-label">Количество</label>
          <input
            type="text"
            class="form-control"
            id="count"
            th:field="${componentDto.count}"
            required="true"
          />
        </div>
        <div>
          <div>
            <button class="btn btn-success button-fixed" type="submit">
              Добавить
            </button>
          </div>
        </div>
      </form>
      <div class="table-responsive" th:if="${id != null}">
        <table class="table">
          <thead>
            <tr>
              <th scope="col">Название</th>
              <th scope="col">Количество</th>
              <th scope="col"></th>
            </tr>
          </thead>
          <tbody>
            <tr
              th:each="component, iterator: ${productDto.getComponentDTOList()}"
            >
              <th
                scope="row"
                th:text="${component.getComponentName()}"
                style="width: 60%"
              />
              <td th:text="${component.getCount()}" />
              <td style="width: 10%">
                <div class="btn-group" role="group" aria-label="Basic example">
                  <button
                    type="button"
                    class="btn btn-danger button-fixed button-sm"
                    th:attr="onclick=|confirm('Удалить запись?') && document.getElementById('remove-${component.id}').click()|"
                  >
                    <i class="fa fa-trash" aria-hidden="true"></i> Удалить
                  </button>
                </div>
                <form
                  th:action="@{/product/delete/{productid}/{id} (id=${component.getId()}, productid=${id})}"
                  method="post"
                >
                  <button
                    th:id="'remove-' + ${component.getId()}"
                    type="submit"
                    style="display: none"
                  >
                    Удалить
                  </button>
                </form>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </main>
  </body>
</html>
